<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>管理画面 - 作品リスト</title>
  <link rel="stylesheet" href="static/style.css">
  <style>
    /* admin.html 専用スタイル */
    body .container { width: 90%; max-width: 600px; margin: 20px auto; }
    #title-list { list-style: none; padding: 0; }
    #title-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: #444;
      border: 1px solid #555;
      margin-bottom: 8px;
      border-radius: 8px;
    }
    #new-title-input { width: 70%; }
    .delete-btn {
      color: #fff;
      background-color: #dc3545;
      border-color: #dc3545;
    }
    .delete-btn:hover { background-color: #c82333; }
  </style>
</head>
<body class="p-3">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1>作品リスト管理</h1>
      <a class="btn btn-outline-secondary" href="index.html">← ホーム</a>
    </div>

    <div class="mb-4 p-3 showing-block">
      <h4>作品を新規追加</h4>
      <div class="d-flex" style="gap: 10px;">
        <input type="text" id="new-title-input" class="form-control" placeholder="例: キングダム">
        <button id="add-btn" class="btn btn-outline-primary">追加</button>
      </div>
    </div>

    <h4>登録済み作品リスト</h4>
    <ul id="title-list">
      </ul>
  </div>

  <script>
    // --- グローバル変数 ---
    const DB_KEY_MOVIES = "movieTitleMaster"; // 作品リスト専用の保存キー
    const listEl = document.getElementById('title-list');
    const inputEl = document.getElementById('new-title-input');
    const addBtn = document.getElementById('add-btn');

    // --- ストレージ操作 ---
    const getMovieTitles = () => {
      // 保存されているデータを取得し、なければ空の配列を返す
      const data = localStorage.getItem(DB_KEY_MOVIES);
      return data ? JSON.parse(data) : [];
    };
    const saveMovieTitles = (titles) => {
      // 配列をソートしてJSONとして保存する
      titles.sort(); // 常に50音順で保存する
      localStorage.setItem(DB_KEY_MOVIES, JSON.stringify(titles));
    };

    // --- 画面描画 ---
    const renderList = () => {
      const titles = getMovieTitles();
      listEl.innerHTML = ''; // リストを一旦空にする
      
      if (titles.length === 0) {
        listEl.innerHTML = '<li>登録済みの作品はありません。</li>';
        return;
      }
      
      titles.forEach(title => {
        const li = document.createElement('li');
        li.textContent = title;
        
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = '削除';
        deleteBtn.className = 'btn btn-sm delete-btn';
        deleteBtn.onclick = () => handleDelete(title);
        
        li.appendChild(deleteBtn);
        listEl.appendChild(li);
      });
    };

    // --- イベント処理 ---
    const handleAdd = () => {
      const newTitle = inputEl.value.trim();
      if (!newTitle) return; // 空なら何もしない
      
      const titles = getMovieTitles();
      if (titles.includes(newTitle)) {
        alert('その作品名はすでに登録されています。');
        return;
      }
      
      titles.push(newTitle);
      saveMovieTitles(titles);
      renderList(); // リストを再描画
      inputEl.value = ''; // 入力欄を空にする
    };

    const handleDelete = (titleToDelete) => {
      if (!confirm(`「${titleToDelete}」をリストから削除しますか？`)) {
        return;
      }
      
      let titles = getMovieTitles();
      titles = titles.filter(title => title !== titleToDelete);
      saveMovieTitles(titles);
      renderList(); // リストを再描画
    };

    // --- 初期化処理 ---
    addBtn.onclick = handleAdd;
    inputEl.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') handleAdd();
    });
    
    renderList(); // ページ読み込み時にリストを描画
  </script>
</body>
</html>